# shunying-image-processing-preview
骑尚·瞬影图片处理服务-预览版


# 功能需求说明

## **系统功能模块**

Python部分的功能需求包括以下模块：

### **2.1 图像上传与信息提取**

- **描述**：当摄影师上传图片时，系统需要自动提取图片的基础信息，并保存至数据库。
- **功能需求**：
    - 提取图片的 **EXIF** 信息（拍摄日期、拍摄设备等）。
    - 提取图片的 **颜色信息**（如：人物衣服、裤子、鞋子的颜色）。
    - 图片需要进行 **哈希重命名**，确保唯一性。
    - 保存图片路径及相关元数据（如上传时间、摄影师ID、图片类型等）。

### **2.2 人物分割与提取**

- **描述**：基于YOLO11-seg模型对图片进行人物分割与提取，识别图片中的骑行者及其周围环境。
- **功能需求**：
    - 使用YOLO11-seg模型对图像进行**人物分割**，将人物从背景中分离出来。
    - 对于每个人物，提取其**位置**（坐标框）、**面部**（如有）、**头盔**、**骑行服**等特征信息。
    - 对图像进行裁剪，确保输出人物为中心，并避免不必要的背景。

### **2.3 图片评分与质量评估**

- **描述**：为每张图片打分，评估图片的清晰度与艺术性，基于图片质量判断是否展示。
- **功能需求**：
    - **清晰度评分**：使用图像处理算法（如模糊度检测）判断图像清晰度。
    - **艺术性评分**：考虑摄影手法（如追焦、景深等），根据拍摄效果打分。
    - 综合考虑各方面信息、给出人物最终评分
    - 若评分低于设定阈值，该图像将不进行展示或进一步处理。
    

### **2.4 人物信息与颜色提取**

- **描述**：提取图片中人物的详细颜色信息（如：头盔颜色、衣服颜色、裤子颜色、鞋子颜色等）。
- **功能需求**：
    - 基于机器学习或图像处理技术提取人物的颜色信息。
    - 将颜色信息保存在数据库中，以供后续筛选和展示。

### **2.5 图片分组与封面图选择**

- **描述**：将同一人物的多张图片进行分组，选择合适的封面图展示。
- **功能需求**：
    - 根据时间、地点和人物的特征，自动将多张图片分为一组。
    - 选择每组图片中的最佳封面图，通常为评分最高的图片，并裁切人物居中。
    - 对于群体照片，需要判断是否符合展示标准（如人数过多或位置不合适）。

### **2.6 图像后期处理**

- **描述**：对图像进行基本的后期处理，如调整亮度、对比度、颜色平衡等，以提高视觉效果。
- **功能需求**：
    - 提供基础的图像调色、亮度与对比度调整功能。
    - 支持图像的 **批量处理**，对多个图像进行同样的后期处理。

### **2.7 图片上传与存储**

- **描述**：处理完的图片将上传至第三方云服务平台，存储相关的图片信息。
- **功能需求**：
    - 将图片保存至云端存储（如AWS S3、阿里云等）。
    - 保存图片的路径、分组信息、评分信息等元数据。
    - 确保图片的安全性和可追溯性。

---

## **3. 非功能性需求**

- **性能要求**：每张图片的处理时间应尽可能短，优先考虑效率。
- **可扩展性**：未来需要支持更多图像处理任务，如图像修复、滤镜效果等。
- **安全性要求**：确保上传的图片不会泄露用户隐私，并遵循相关的版权法。
- **错误处理**：系统应具备错误日志记录功能，能够在出错时进行自我修复或报警。

---

流程图

- 上传图片：

*上传时填写：*

*拍摄地点信息&摄影师信息(账号id/匿名/官方)*

↓

- 图片(存储)：*图片存储至服务器本地*

↓（*读取图片*）

- 图片重命名(*哈希重命名, (确保图片名称唯一性)*)（或其他选项）
- 存储字段：图片id（主键自增）、原图片名（仅保留）、新图片名

↓

- 图片信息提取

*基于ExifTool工具提取：*

*· 核心信息：拍摄日期、时间(精确到S或ms(基于相机厂商、型号不同，时间精度不同；))*

*· 其他信息：图片规格 拍摄设备  镜头信息 快门速度 光圈值 感光度 EV值 白平衡*

· 更多信息：提取全部信息留档保存(暂定存为csv)

注意：这步的图片名称应为重命名后的新图片名、避免重复；

↓

- yolo处理

yolo11-seg模型提取： 

位置信息：车辆（汽车、摩托车、自行车）信息（边界框 bounding box）

分割信息：精细分割人物的信息（mask）

存储字段：图片表：bounding box信息、其他必要信息；人物表：mask信息、原图id（关联图片表）

- *提取人物计算前置条件信息*

*resnet 152特征向量&其他必要信息*

存储至：人物表

- 提取相关信息计算人物综合评分

主体重要性评分：判断该人物是否为照片的预期主体。

图片质量评分：

清晰度评分：使用图像处理算法（如模糊度检测）判断图像清晰度。

艺术性评分：考虑摄影手法（如追焦、景深等），根据拍摄效果打分。

综合考虑各方面信息、给出人物最终评分

注：详细实现方法参考下方说明

- 提取颜色信息

提取人物骑行服、骑行裤、鞋子颜色信息

↓

- 人物分组

基于图片基础信息中的拍摄时间信息，分割出时间窗口（例如按阈值2秒进行分割窗口）

窗口内进行人物分组：

目的：区分一张图片中的多名骑行者；区分分割错误（低于阈值但是是两名骑行者图片的情况）

实现（预想）：基于*提取人物计算前置条件信息*等必要信息进行机器学习模型训练，给出人物分组

↓

- 群组照片检测

目的：如一张图片出现多人（例如5-6人以上），出于用户体验角度、其应被合并为一组

实现（预想）：基于人物（边界框 bounding box）信息、人物数量等判断是否改为群组图片

- 检查人物分组必要性

目的：排除如路人（在图片边缘且不是摄影师拍摄主体的人物）等人物；不清晰人物（如摄影师拍摄a，但图片边缘有b，如果b没有被当作拍摄主体的图片（仅有边缘不清晰、不好图）的情况，b的图片组应被移除）

实现（预想）：基于（边界框 bounding box）信息、群组图片信息、人物评分信息判断图片组是否成立

其他：如一个图片组（一个人）出现在群组图片中，但其也有被当作拍摄主体的图片，则其组应该成立而不是移除

- 压缩、处理图片

封面图：每个图片组（每个人物）选择一张评分最高的图片，制作封边图（将人物裁切为画面中心并放大到同一大小）

预览图：将原图压缩清晰度与大小（适用于用户查看）

原图：保持不变

图片、人物评分说明：

